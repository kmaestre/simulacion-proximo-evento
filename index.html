<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Proyecto #2 | Simulación y Modelos</title>
  <link rel="stylesheet" href="vendor/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="vendor/alertify.min.css">
  <link rel="stylesheet" type="text/css" href="vendor/alertify.bootstrap.min.css">
  <style>
    * {
      font-family: 'Fira Code'
    }


    #conditionWrapper {
      display: none
    }
  </style>

</head>

<body class="container-fluid">
  <div class="row" style="display: hidden">
  </div>

  <div class="full row d-flex justify-content-center align-items-center">
    <div id="form">
      <h4 class="text-center">Parametros Iniciales:</h4>
      <br>
      <div class="form-group">
        <label for="">Nº de entidades en el sistema:</label>
        <input type="text" class="form-control" id="entities" oninput="soloNumeros()" onkeydown="removeBorders()">
      </div>
      <div class="form-group">
        <label for="">Condicion de Parada</label>
        <select class="form-control" id="stop" onchange="setInput()">
          <option value="">Seleccionar</option>
          <option value="1">Nº de Solicitudes</option>
          <option value="2">Nº de Finalizados</option>
          <option value="3">Tiempo de simulacion</option>
        </select>
      </div>
      <div id="conditionWrapper">
        <div class="form-group">
          <label for="" id="stopLabel"></label>
          <input class="form-control" id="stopValue1" name="input" onkeydown="removeBorders()" oninput="soloNumeros()">
          <input class="form-control" id="stopValue2" name="input" onkeydown="removeBorders()">
        </div>
      </div>

      <div class="form-group">
        <button id="runBtn" class="btn btn-dark btn-block btn-sm" disabled onclick="runSimulation()">Iniciar</button>
      </div>
    </div>
  </div>

  <script src="vendor/jquery-slim.min.js"></script>
  <script src="vendor/popper.min.js"></script>
  <script src="vendor/bootstrap.min.js"></script>
  <script src="vendor/alertify.js"></script>


  <script>
    //parametros inciales
    var fArrival;
    var fDeparture;

    //variables globales
    var arrivals = [];
    var departures = [];
    var clock = 0;
    var entities = 0;

    $('#dataInput').modal()

    $(function () {
      $('#content-tab').on('click', function (e) {
        e.preventDefault()
        $(this).tab('show')
      })
    })

    const soloNumeros = () => {
      event.target.value = event.target.value.replace(/\D/gi, '')
    }
    const soloNumeros2 = () => {
      event.target.value = event.target.value.replace(/(\D)/gi, '')
    }

    const removeBorders = () => {
      event.target.style = ''
      $('errorLabel').css('display', 'none')
    }

    const setInput = () => {
      let val = event.target.value
      if (val == '') {
        $('#conditionWrapper').css('display', 'none')
        $('#runBtn').attr('disabled', true)
        return
      }
      if ('1' === val || '2' === val) {
        $('#stopLabel').text('Cantidad');
        $('#stopValue2').css('display', 'none')
        $('#stopValue1').css('display', 'block')
      }
      if ('3' === val) {
        $('#stopLabel').text('Tiempo(seg)')
        $('#stopValue1').css('display', 'none')
        $('#stopValue2').css('display', 'block')

      }

      $('#conditionWrapper').css('display', 'block')
      $('#runBtn').attr('disabled', false)
    }

    const runSimulation = () => {
      let stopOption = document.getElementById('stop').value
      let stopValue = ''
      let initEntities = document.getElementById('entities').value

      if (!initEntities) {
        document.getElementById('entities').style = 'border: 1px solid red; color: red;'
        return
      } else {
        entities = initEntities
      }
      if (stopOption == '1' && document.getElementById('stopValue1').value != '') {
        // preparar condicion de parada para este caso 
        stopValue = document.getElementById('stopValue1').value
      } else if (stopOption == '2' && document.getElementById('stopValue1').value != '') {
        // preparar condicion de parada para este caso
        stopValue = document.getElementById('stopValue1').value
      } else if (stopOption == '3' && document.getElementById('stopValue2').value != '') {
        // preparar condicion de parada para este caso
        stopValue = document.getElementById('stopValue2').value
      } else {
        if (!stopValue) {
          if (stopOption == '1' || stopOption == '2') {
            document.getElementById('stopValue1').style = 'border: 1px solid red; color: red;'
          }
          if (stopOption == '3') {
            document.getElementById('stopValue2').style = 'border: 1px solid red; color: red;'
          }
          return
        }
        alertify.alert('Info', 'La simulacion se detendra al llegar a los ' + parseInt(stopValue) + ' segundos')
      }

      console.log(initEntities, stopOption, stopValue)

      setFirstArrivalQuestion()
    }
    const setFirstDepartureQuestion = () => {
      let html = `
        <div class="modal-body text-center">
          <p>¿Desea indicar el tiempo de la primera <strong>finalizacion de servicio?</strong></p>
          <div class="row">
            <div class="form-group col-5 mx-auto">
              <button class="btn btn-danger btn-block" onclick="fDeparture = null">No</button>
            </div>
            <div class="form-group col-5 mx-auto">
              <button class="btn btn-dark btn-block" onclick="setFirstDeparture()">Si</button>
            </div>
          </div>
        </div>
      `

      $('#form').html(html)
    }
    const setFirstArrivalQuestion = () => {
      let html = `
        <div class="modal-body text-center">
          <p>¿Desea indicar el tiempo de la primera <strong>solicitud de servicio?</strong></p>
          <div class="row">
            <div class="form-group col-5 mx-auto">
              <button class="btn btn-danger btn-block" onclick="fArrival = null;setFirstDepartureQuestion()">No</button>
            </div>
            <div class="form-group col-5 mx-auto">
              <button class="btn btn-dark btn-block" onclick="setFirstArrival()">Si</button>
            </div>
          </div>
        </div>
      `

      $('#form').html(html)
    }
    const setFirstArrival = () => {
      let html = `
        <div class="modal-body text-center">
          <div class="form-group col-12 mx-auto">
            <label>Tiempo (seg)</label>
            <input type="text" class="form-control input-sm" id="firstReq" oninput="soloNumeros()" onfocus="removeBorders()">
          </div>
          <div class="form-group col-5 mx-auto">
            <button class="btn btn-dark btn-block" onclick="
              let val = $('#firstReq').val()
              if (val == '') {
                document.getElementById('firstReq').style = 'border: 1px solid red; color: red;'
                return
              }

              fArrival = val
              setFirstDepartureQuestion()
            ">Aceptar</button>
          </div>
        </div>
      `

      $('#form').html(html)
    }
    const setFirstDeparture = () => {
      let html = `
        <div class="modal-body text-center">
          <div class="form-group col-12 mx-auto">
            <label>Tiempo de Finalizacion <small>(seg)</small>:</label>
            <input type="text" class="form-control input-sm" id="firstDep" onfocus="removeBorders()" oninput="soloNumeros()">
          </div>
          <div class="form-group col-5 mx-auto">
            <button class="btn btn-dark btn-block"  onclick="
              let val = $('#firstDep').val()
              if (val == '') {
                document.getElementById('firstDep').style = 'border: 1px solid red; color: red;'
                return
              }

              fDeparture = val">Aceptar</button>
          </div>
        </div>
      `

      $('#form').html(html)
    }
    const currentEvent = () => {
      if (clock+arrivals[0] < clock+departures[0]) {
        return ('E1')
      }
    }
  </script>
</body>

</html>